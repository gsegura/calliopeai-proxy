# Calliope Proxy Service

## Description

This service acts as a proxy layer for various external APIs, including web search, website crawling, and Large Language Model (LLM) providers. It standardizes access to these services, manages authentication, and provides a unified interface for the Calliope project.

## Prerequisites

To run this project, you will need:
- [Node.js](https://nodejs.org/) (v18.x or later recommended)
- [npm](https://www.npmjs.com/) (comes with Node.js)

## Installation

1.  Clone the repository:
    ```bash
    git clone <repository-url>
    cd <repository-name>
    ```
2.  Install dependencies:
    ```bash
    npm install
    ```

## Environment Variables

Configuration for the application is managed through environment variables.

1.  Create a `.env` file in the root of the project by copying the example file:
    ```bash
    cp .env.example .env
    ```
2.  Edit the `.env` file and provide values for the required variables.

### Required Variables:

*   `SEARCHAPI_API_KEY`: API key for SearchAPI.io, used by the `/api/web` endpoint for web searches.

### Optional Variables:

*   `PORT`: The port on which the server will listen. Defaults to `3000`.

### Placeholder LLM API Keys:

The `.env.example` file includes placeholders for common LLM providers (e.g., `OPENAI_API_KEY`, `ANTHROPIC_API_KEY`). You will need to add the actual API keys for any LLM providers you intend to use with the `/model-proxy/v1` endpoints. The specific key required will depend on the `model` string passed in the request to these proxy endpoints (e.g., a model string like `openai/gpt-4o/openai/gpt-4o` would imply that `OPENAI_API_KEY` should be set).

## Running the Application

### Development Mode

To run the application in development mode with live reloading (using `ts-node`):
```bash
npm run dev
```
The server will typically be available at `http://localhost:PORT`.

### Production Mode

1.  **Build the TypeScript code:**
    ```bash
    npm run build
    ```
    This command compiles the TypeScript files from `src` into JavaScript files in the `dist` directory.

2.  **Start the server:**
    ```bash
    npm start
    ```
    This command runs the compiled application from the `dist` directory using Node.js.

## API Endpoints

This service provides the following main sets of endpoints. For detailed API specifications, please refer to the `calliope_proxy_oas.yaml` OpenAPI specification file.

*   **`/api/web` (POST)**
    *   Purpose: Proxies requests to a web search provider (currently SearchAPI.io via Langchain).
    *   Authentication: Requires Calliope-specific headers (`key`, `timestamp`, `v`, `extensionversion`, `os`, `uniqueid`).
*   **`/api/crawl` (POST)**
    *   Purpose: Crawls a website based on a starting URL, depth, and limit. Uses `crawlee`.
    *   Authentication: Requires Calliope-specific headers (same as `/api/web`).
*   **`/model-proxy/v1/...`**
    *   This path hosts various endpoints for proxying requests to different LLM providers.
    *   Endpoints include:
        *   `/chat/completions` (POST)
        *   `/completions` (POST)
        *   `/embeddings` (POST)
        *   `/rerank` (POST)
    *   Authentication: Requires a Bearer token in the `Authorization` header.
*   **`/` (GET)**
    *   Purpose: A simple health check endpoint.
    *   Authentication: None.

## Project Structure

A brief overview of the main directories in the project:

*   **`src/`**: Contains all the TypeScript source code.
    *   **`controllers/`**: Handles the business logic for incoming requests.
    *   **`middleware/`**: Contains Express middleware functions (e.g., authentication, error handling).
    *   **`routes/`**: Defines the API routes and maps them to controller functions.
    *   **`services/`**: (Currently less used, but intended for more complex business logic or third-party service integrations if controllers become too large).
    *   **`utils/`**: Utility functions used across the application.
    *   **`index.ts`**: The main entry point for the application, sets up the Express server.
*   **`dist/`**: Contains the compiled JavaScript code (generated by `npm run build`).
*   **`.env.example`**: Example file for environment variables.
*   **`README.md`**: This file.
*   **`package.json`**: Lists project dependencies and npm scripts.
*   **`tsconfig.json`**: Configuration for the TypeScript compiler.

---

This README provides a basic guide to getting the Calliope Proxy Service up and running. Refer to the source code and OpenAPI specification for more detailed information.
